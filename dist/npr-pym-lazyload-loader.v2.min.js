/*! npr-pym-lazyload-loader.js - v2.0.1 - 2017-07-11 */

!function(a,b){var c=[],d=function(a){var b=document.createEvent("Event");b.initEvent("npr-pym-lazyload-loader:"+a,!0,!0),document.dispatchEvent(b)},e=function(){var a=/^https?:\/\/(www(-s1)?\.)?npr\.org/;return!!window.location.href.match(a)},f=function(a){var b=document.createElement("a");b.style.display="none",b.setAttribute("href",a),document.getElementById("main-section").appendChild(b),b.click(),b.parentNode.removeChild(b)},g=function(a,b){if(a){b||d("pym-loaded");for(var g=document.querySelectorAll("[data-pym-lazyload-loader]:not([data-embed-loaded])"),h=0;h<g.length;++h)null!==g[h].getAttribute("id")?null!==g[h].getAttribute("data-child-src")?(!function(){var b=g[h],d=new a.Parent(b.getAttribute("id"),b.getAttribute("data-child-src"),{});b.setAttribute("data-embed-loaded",""),e()&&d.onMessage("pjax-navigate",f),c.push(d)}(),window.npr_pym_lazyload_loader_loading=void 0):console.error("container element does not have a data-child-src attribute"):console.error("container element does not have an id attribute");return!0}return!1},h=function(a){0!==this.el.getElementsByTagName("iframe").length&&this.sendMessage("element-read",a)},i=function(){var a=location.hash;0!==this.el.getElementsByTagName("iframe").length&&this.sendMessage("visibility-available",a)},j=function(a){this.trackers[a].stopTracking(),delete this.trackers[a]},k=function(a,b){var c={};if(a){var d=new a.VisibilityTracker(this,b,h.bind(this,b),c);this.trackers[b]=d}else{var e=new window.ChildTracker.VisibilityTracker(this,b,h.bind(this,b),c);this.trackers[b]=e}},l=function(a,b,e){if(a){e||d("tracker-loaded");for(var f=c,g=0;g<f.length;++g)!function(){var a=f[g];a.trackers={},a.onMessage("test-visibility-tracker",i),a.onMessage("remove-tracker",j),a.onMessage("request-tracking",k.bind(a,b))}()}},m=function(a,b,e){if(a&&b){e||d("carebot-loaded");for(var f=c,g=0;g<f.length;++g)null==f[g].el.getAttribute("data-carebot-skip")&&function(){var a=f[g];new b.VisibilityTracker(a.id,function(b){0!==a.el.getElementsByTagName("iframe").length&&a.sendMessage("on-screen",b.bucket)}),e||d("carebot-visibility-added"),document.querySelector("[data-carebot-scroll]")||(e||d("carebot-scroll-added"),a.el.setAttribute("data-carebot-scroll",""),new b.ScrollTracker("storytext",function(b,c){0!==a.el.getElementsByTagName("iframe").length&&a.sendMessage("scroll-depth",JSON.stringify({percent:b,seconds:c}))}))}()}},n="https://pym.nprapps.org/pym.v1.min.js",o="https://carebot.nprapps.org/carebot-tracker.v0.min.js",p="https://carebot.nprapps.org/child-tracker.v2.min.js";o=e()?o:null,window.npr_pym_lazyload_loader_loading||(window.npr_pym_lazyload_loader_loading=!0,function(b,c,d){if(void 0!==a){b=b.split(".js")[0],d=d.split(".js")[0];var e={pym:b,tracker:d},f={pym:{exports:"pym"},tracker:{exports:"tracker"}},h=["require","pym","tracker"];c&&(c=c.split(".js")[0],e.carebot=c,f.carebot={exports:"carebot"},h.push("carebot"));var i="context_lazyload_"+b.split("/").slice(-1)[0];return a.config({context:i,paths:e,shim:f})(h,function(a,b,c,d){g(b),l(b,c),d&&m(b,d)}),!0}return!1}(n,o,p)||function(a,c,d){return void 0!==b&&"function"==typeof b.getScript&&(b.getScript(a).done(function(){b(function(){g(window.pym),b.getScript(d).done(function(){l(window.pym)}),c&&b.getScript(c).done(function(){m(window.pym,window.CarebotTracker)})})}).fail(function(){console.error("could not load pym with jQuery"),window.npr_pym_lazyload_loader_loading=void 0}),!0)}(n,o,p)||function(a,b,c){var d=document.getElementsByTagName("head")[0],e=document.createElement("script");e.type="text/javascript",e.src=a,e.onload=function(){d&&e.parentNode&&d.removeChild(e),g(window.pym),d=document.getElementsByTagName("head")[0];var a=document.createElement("script");a.type="text/javascript",a.src=c,a.onload=function(){if(d&&a.parentNode&&d.removeChild(a),l(window.pym),b){d=document.getElementsByTagName("head")[0];var c=document.createElement("script");c.type="text/javascript",c.src=b,c.onload=function(){d&&c.parentNode&&d.removeChild(c),m(window.pym,window.CarebotTracker)},d.appendChild(c)}},d.appendChild(a)},e.onerror=function(){console.error("could not append pym via embedding"),window.npr_pym_lazyload_loader_loading=void 0},d.appendChild(e)}(n,o,p))}(window.requirejs,window.jQuery);